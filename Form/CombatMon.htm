<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Cтруктура боевого стэка</title></head>
<LINK REL="stylesheet" MEDIA="screen" TYPE="text/css" HREF="../style.css">
<script language="JScript" src="../rec/script.js"></script></head>
<body>
<p align="left">
<font size="5">Cтруктура боевого стэка</font><br>
<div id="Q1">Все смещения указаны в hex-нотации.</div></p>
<p>
<pre>
	<b id="N2">Смещение		Описание</b>
   // <b id="dred">+00</b> db (1) когда атаковал уже (?)
   // <b id="dred">+01</b> db
   // <b id="dred">+02</b> db (0x0C) <i class="event">44188C</i>
   // <b id="dred">+03</b> db
   // <b id="dred">+08</b> dd = полное число стеков у игрока
   // <b id="dred">+08</b> db = Видимость существа (4 - виден, 8 - не виден)
   // <b id="dred">+10</b> dd = -1 после атаки и/или ответа (???)
   // <b id="dred">+1С</b> dd = <a target="form" href="../form/BF.htm">позиция</a> на поле боя (куда бежать/стрелять)
   // <b id="dred">+20</b> db = встроенная способность повреждать Огненным щитом
   // <b id="dred">+21</b> db = в движении???
   // <b id="dred">+24</b> dd = номер стэка клона родительского
   // <b id="dred">+28</b> dd = -1 (номер стэка клона дочернего)
   // <b id="dred">+30</b> dd ? Есть ли цифры кол-ва существ? 0-есть, 1-нет.
   // <b id="dred">+30</b> db - <i class="event">43E33C</i>
   // <b id="dred">+34</b> dd = <a target="form" href="Creature.htm">тип монстра</a>
   // <b id="dred">+38</b> dd = позиция монстра на поле боя (куда атакует)
   // <b id="dred">+3C</b> dd = номер анимации
   // <b id="dred">+40</b> dd = номер кадра анимации (<i class="event">43E236</i>)
   // <b id="dred">+44</b> dd (=1) сдвиг в сторону второй занятой клетки для монстра с двумя клетками
   // <b id="dred">+4C</b> dd ? число монстров
   // <b id="dred">+50</b> dd ? число монстров до удара по ним в тек. атаку
   // <b id="dred">+58</b> dd ? потери здоровья последнего монстра
   // <b id="dred">+5C</b> dd ? номер слота героя (0..6), -1 - будет удалён после битвы
   // <b id="dred">+60</b> dd ? численность в начале битвы
   // <b id="dred">+6C</b> dd ? полное здоровье (исп. как база для лечения)
   // <b id="dred">+70</b> dd <i class="event">44150F</i> <i class="event">441744</i> (выпала Удача)
   // загруженная копия H3CreatureInfo
   // <b id="dred">+74</b> dd фракция монстра (-1 для продвинутых элементалей)
   // <b id="dred">+78</b> dd = уровень существа (0..6)
   // <b id="dred">+7С</b> dd ? озвучка
   // <b id="dred">+80</b> dd ? боевой def
   // <b id="dred">+84</b> dd = <a href="javascript:void(0)" onclick="hidepic(1)" class="h">флаги монстра</a><div id="1" class="b"><blockquote id="T0">
// 00000001 - 0x00 занимает 2 клетки
// 00000002 - 0x01 летает
// 00000004 - 0x02 стреляет
// 00000008 - 0x03 расширенный радиус атаки (на две клетки)
// 00000010 - 0x04 живое существо (можно восстанавливаться вампиру)
// 00000020 - 0x05 КАТАПУЛЬТА - может разрушать стены
// 00000040 - 0x06 ОСАДНОЕ ОРУДИЕ - не двигается (5508CB)
// 00000080 - 0x07 КОРОЛЬ_1
// 00000100 - 0x08 КОРОЛЬ_2
// 00000200 - 0x09 КОРОЛЬ_3
// 00000400 - 0x0A ??? 00020000 + 40, 41, 83 - не чуствителен к псих. атаке
// 00000800 - 0x0B стрельба лучом (как существа 35, 74, 75)
// 00001000 - 0x0C в ближнем бою бьёт как в дальнем
// 00002000 - 0x0D НЕ ИСПОЛЬЗУЕТСЯ
// 00004000 - 0x0E ??? ИММУНИТЕТ К ЗАКЛАМ ОГНЯ
// 00008000 - 0x0F стреляет дважды
// 00010000 - 0x10 атака без ответа
// 00020000 - 0x11 ... не подвержен низкой морали (?)
// Существа 32,33,56-69,112-117,120,121,123,125,127,129,141,145-149
// 00040000 - 0x12 нечисть
// 00080000 - 0x13 бьёт всех врагов рядом
// 00100000 - 0x14 расширенный радиус стреляющих юнитов
// 00200000 - 0x15 стэк убит? <i class="event">41E617</i> чародей, огнен.птица - может еще кастовать?
// 00400000 - 0x16 <i class="event">421BDC</i>, <i class="event">421FC4</i> (что-то с вызовом)
// 00800000 - 0x17 КЛОН - умирает сразу
// 01000000 - 0x18 гарпии-ведьмы
// 02000000 - 0x19 остался (уже) ждать СБРОСИТЬ - МОЖЕТ ЖДАТЬ СНОВА
// 04000000 - 0x1A уст. после атаки СБРОСИТЬ - ВНОВЬ МОЖЕТ АТАКОВАТЬ
// 08000000 - 0x1B - выбрал защиту
// 10000000 - 0x1C - не может быть воскрешён ???
// 20000000 - 0x1D + <i class="event">43DFAF</i>
// 40000000 - 0x1E + <i class="event">43E06F</i>
// 80000000 - 0x1F ДРАКОН</blockquote></div>
   // <b id="dred">+88</b> dd = имя монстра
   // <b id="dred">+8C</b> dd = имя во мн.ч.
   // <b id="dred">+90</b> dd = описание монстра (например "Нет штрафа в рукопашной")
   // <b id="dred">+B0</b> dd = ? дополн.прирост
   // <b id="dred">+C0</b> dd = здоровье монстра
   // <b id="dred">+С4</b> dd = скорость монстра
   // <b id="dred">+C8</b> dd = атака с бонусами
   // <b id="dred">+CC</b> dd = защита с бонусами
   // <b id="dred">+D0</b> dd = мин. урон
   // <b id="dred">+D4</b> dd = макс. урон
   // <b id="dred">+D8</b> dd = боезапас
   // <b id="dred">+DC</b> dd = кол-во заклинаний (0 = нет) ДЛЯ ВОСКРЕШЕНИЯ УВЕЛИЧИТЬ
   // Флаги состояния стека dd ?
   // <b id="dred">+E8</b> db = 1, нужно ударить Огненным щитом
   // <b id="dred">+E9</b> db = 1, если хоть раз били стэк
   // <b id="dred">+EA</b> db = 1, если умирал хоть один
   // <b id="dred">+EB</b> db = 1, если был убит весь стэк
   // <b id="dred">+EC</b> dd = номер заклинания существа в тек. раунде (0x50 Кислотное дыхание)
   // <b id="dred">+F0</b> db = 1 перед атакой на него <i class="event">441434</i>, <i class="event">44016F</i>
   // <b id="dred">+F4</b> dd = сторона (<a href="../Rec/BM.htm#I" target="main">BM:I</a>)
   // <b id="dred">+F8</b> dd = номер стэка у стороны на поле боя
   // <b id="dred">+FC</b> dd = ? (last_animation_time)
   // <b id="dred">+100</b> dd - Смещение существа по Y <i class="event">43DEA4</i>
   // <b id="dred">+104</b> dd - Смещение существа по X <i class="event">43DEAD</i>
   // От того места где должен быть, в пикселях
   // <b id="dred">+110</b> dd ? что-то со скоростью анимации
   // <b id="dred">+158</b> dd = ?
   // <b id="dred">+164</b> dd - Загруженный def монстра &rarr; <i class="file">ctroll.def</i> (тролль)
   // <b id="dred">+168</b> db - загруж. def снаряда (иниц. в <i class="event">43DA8E</i>)
   // <b id="dred">+170</b> dd - Звук перемещения (загруженный wav?)
   // <b id="dred">+174</b> dd - Звук атаки
   // <b id="dred">+178</b> dd - Звук урона
   // <b id="dred">+17C</b> dd - Звук выстрела
   // <b id="dred">+180</b> dd - Звук смерти
   // <b id="dred">+184</b> dd - Звук защиты
   // <b id="dred">+188</b> dd - extraSound1
   // <b id="dred">+18C</b> dd - extraSound2
   // <b id="dred">+194</b> dd = кол-во уже наложенных заклинаний (для отображения цвета кол-ва существ)
   // <b id="dred">+198</b> dd*? <a href="javascript:void(0)" onclick="hidepic(2)" class="h">есть заклинание (длительность) или нет, по номерам</a><div id="2" class="b"><blockquote id="T0">
// <b id="dred">+198</b> dd = Вызвать корабль
// <b id="dred">+19C</b> dd = Затопить корабль
// <b id="dred">+1A0</b> dd = Видения
// <b id="dred">+1A4</b> dd = Просмотр земли
// <b id="dred">+1A8</b> dd = Маскировка
// <b id="dred">+1AC</b> dd = Просмотр воздуха
// <b id="dred">+1B0</b> dd = Полёт
// <b id="dred">+1B4</b> dd = Хождение по воде
// <b id="dred">+1B8</b> dd = Дверь измерений
// <b id="dred">+1BC</b> dd = Городской портал

// <b id="dred">+1C0</b> dd = Зыбучие пески
// <b id="dred">+1C4</b> dd = Минное поле
// <b id="dred">+1C8</b> dd = Силовое поле
// <b id="dred">+1CC</b> dd = Стена огня
// <b id="dred">+1D0</b> dd = Землетрясение
// <b id="dred">+1D4</b> dd = Волшебная стрела
// <b id="dred">+1D8</b> dd = Ледяная молния
// <b id="dred">+1DC</b> dd = Удар молнии
// <b id="dred">+1E0</b> dd = Взрыв
// <b id="dred">+1E4</b> dd = Цепная молния
// <b id="dred">+1E8</b> dd = Кольцо холода
// <b id="dred">+1EC</b> dd = Огненный шар
// <b id="dred">+1F0</b> dd = Инферно
// <b id="dred">+1F4</b> dd = Метеоритный дождь
// <b id="dred">+1F8</b> dd = Волна смерти
// <b id="dred">+1FC</b> dd = Уничтожить нежить
// <b id="dred">+200</b> dd = Армагеддон
// <b id="dred">+204</b> dd = Щит
// <b id="dred">+208</b> dd = Воздушный щит
// <b id="dred">+20C</b> dd = Огненный щит
// <b id="dred">+210</b> dd = Защита от воздуха
// <b id="dred">+214</b> dd = Защита от огня
// <b id="dred">+218</b> dd = Защита от воды
// <b id="dred">+21C</b> dd = Защита от земли
// <b id="dred">+220</b> dd = Антимагия
// <b id="dred">+224</b> dd = Снятие заклинания
// <b id="dred">+228</b> dd = Волшебное зеркало
// <b id="dred">+22C</b> dd = Лечение
// <b id="dred">+230</b> dd = Воскрешение
// <b id="dred">+234</b> dd = Оживление мертвецов
// <b id="dred">+238</b> dd = Жертва
// <b id="dred">+23C</b> dd = Благословение
// <b id="dred">+240</b> dd = Проклятье
// <b id="dred">+244</b> dd = Жажда крови
// <b id="dred">+248</b> dd = Точность
// <b id="dred">+24C</b> dd = Слабость
// <b id="dred">+250</b> dd = Каменная кожа
// <b id="dred">+254</b> dd = Разрушающий луч
// <b id="dred">+258</b> dd = Молитва
// <b id="dred">+25C</b> dd = Радость
// <b id="dred">+260</b> dd = Печаль
// <b id="dred">+264</b> dd = Удача
// <b id="dred">+268</b> dd = Неудача
// <b id="dred">+26C</b> dd = Ускорение
// <b id="dred">+270</b> dd = Медлительность
// <b id="dred">+274</b> dd = Палач
// <b id="dred">+278</b> dd = Бешенство
// <b id="dred">+27C</b> dd = Гром титанов
// <b id="dred">+280</b> dd = Контрудар
// <b id="dred">+284</b> dd = Берсерк
// <b id="dred">+288</b> dd = Гипноз
// <b id="dred">+28C</b> dd = Забывчивость
// <b id="dred">+290</b> dd = Слепота
// <b id="dred">+294</b> dd = Телепорт
// <b id="dred">+298</b> dd = Убрать препятствие
// <b id="dred">+29C</b> dd = Клон
// <b id="dred">+2A0</b> dd = Вызов элемента огня
// <b id="dred">+2A4</b> dd = Вызов элемента земли 
// <b id="dred">+2A8</b> dd = Вызов элемента воды
// <b id="dred">+2AC</b> dd = Вызов элемента воздуха

// <b id="dred">+2B0</b> dd = Окаменение <i class="event">443D3A</i> <i class="event">43E0EB</i> <i class="event">441B0D</i> (1 = не отв. на атаку)
// <b id="dred">+2B4</b> dd = Яд
// <b id="dred">+2B8</b> dd = Корни
// <b id="dred">+2BC</b> dd = Болезнь
// <b id="dred">+2C0</b> dd = Паралич
// <b id="dred">+2C4</b> dd = Старость
// <b id="dred">+2C8</b> dd = Облако Смерти
// <b id="dred">+2CC</b> dd = Удар Молнии
// <b id="dred">+2D0</b> dd = Снять полезные заклинания
// <b id="dred">+2D4</b> dd = Смертельный взгляд
// <b id="dred">+2D8</b> dd = Кислотное дыхание</blockquote></div>
   // <b id="dred">+2DC</b> dd*? <a href="javascript:void(0)" onclick="hidepic(3)" class="h">сила действия заклинания</a><div id="3" class="b"><blockquote id="T0">
// <b id="dred">+2DC</b> dd = Вызвать корабль
// <b id="dred">+2E0</b> dd = Затопить корабль
// <b id="dred">+2E4</b> dd = Видения
// <b id="dred">+2E8</b> dd = Просмотр земли
// <b id="dred">+2EC</b> dd = Маскировка
// <b id="dred">+2F0</b> dd = Просмотр воздуха
// <b id="dred">+2F4</b> dd = Полёт
// <b id="dred">+2F8</b> dd = Хождение по воде
// <b id="dred">+2FC</b> dd = Дверь измерений
// <b id="dred">+300</b> dd = Городской портал

// <b id="dred">+304</b> dd = Зыбучие пески
// <b id="dred">+308</b> dd = Минное поле
// <b id="dred">+30C</b> dd = Силовое поле
// <b id="dred">+310</b> dd = Стена огня
// <b id="dred">+314</b> dd = Землетрясение
// <b id="dred">+318</b> dd = Волшебная стрела
// <b id="dred">+31C</b> dd = Ледяная молния
// <b id="dred">+320</b> dd = Удар молнии
// <b id="dred">+324</b> dd = Взрыв
// <b id="dred">+328</b> dd = Цепная молния
// <b id="dred">+32C</b> dd = Кольцо холода
// <b id="dred">+330</b> dd = Огненный шар
// <b id="dred">+334</b> dd = Инферно
// <b id="dred">+338</b> dd = Метеоритный дождь
// <b id="dred">+33C</b> dd = Волна смерти
// <b id="dred">+340</b> dd = Уничтожить нежить
// <b id="dred">+344</b> dd = Армагеддон
// <b id="dred">+348</b> dd = Щит
// <b id="dred">+34C</b> dd = Воздушный щит
// <b id="dred">+350</b> dd = Огненный щит
// <b id="dred">+354</b> dd = Защита от воздуха
// <b id="dred">+358</b> dd = Защита от огня
// <b id="dred">+35C</b> dd = Защита от воды
// <b id="dred">+360</b> dd = Защита от земли
// <b id="dred">+364</b> dd = Антимагия
// <b id="dred">+368</b> dd = Снятие заклинания
// <b id="dred">+36C</b> dd = Волшебное зеркало
// <b id="dred">+370</b> dd = Лечение
// <b id="dred">+374</b> dd = Воскрешение
// <b id="dred">+378</b> dd = Оживление мертвецов
// <b id="dred">+37C</b> dd = Жертва
// <b id="dred">+380</b> dd = Благословение
// <b id="dred">+384</b> dd = Проклятье
// <b id="dred">+388</b> dd = Жажда крови
// <b id="dred">+38C</b> dd = Точность
// <b id="dred">+390</b> dd = Слабость
// <b id="dred">+394</b> dd = Каменная кожа
// <b id="dred">+398</b> dd = Разрушающий луч
// <b id="dred">+39C</b> dd = Молитва
// <b id="dred">+3A0</b> dd = Радость
// <b id="dred">+3A4</b> dd = Печаль
// <b id="dred">+3A8</b> dd = Удача
// <b id="dred">+3AC</b> dd = Неудача
// <b id="dred">+3B0</b> dd = Ускорение
// <b id="dred">+3B4</b> dd = Медлительность
// <b id="dred">+3B8</b> dd = Палач
// <b id="dred">+3BC</b> dd = Бешенство
// <b id="dred">+3C0</b> dd = Гром титанов
// <b id="dred">+3C4</b> dd = Контрудар
// <b id="dred">+3C8</b> dd = Берсерк
// <b id="dred">+3CC</b> dd = Гипноз
// <b id="dred">+3D0</b> dd = Забывчивость
// <b id="dred">+3D4</b> dd = Слепота
// <b id="dred">+3D8</b> dd = Телепорт
// <b id="dred">+3DC</b> dd = Убрать препятствие
// <b id="dred">+3E0</b> dd = Клон
// <b id="dred">+3E4</b> dd = Вызов элемента огня
// <b id="dred">+3E8</b> dd = Вызов элемента земли 
// <b id="dred">+3EC</b> dd = Вызов элемента воды
// <b id="dred">+3F0</b> dd = Вызов элемента воздуха

// <b id="dred">+3F4</b> dd = Окаменение <i class="event">443D3A</i> <i class="event">43E0EB</i> <i class="event">441B0D</i> (1 = не отв. на атаку)
// <b id="dred">+3F8</b> dd = Яд
// <b id="dred">+3FC</b> dd = Корни
// <b id="dred">+400</b> dd = Болезнь
// <b id="dred">+404</b> dd = Паралич
// <b id="dred">+408</b> dd = Старость
// <b id="dred">+40C</b> dd = Облако Смерти
// <b id="dred">+410</b> dd = Удар Молнии
// <b id="dred">+414</b> dd = Снять полезные заклинания
// <b id="dred">+418</b> dd = Смертельный взгляд
// <b id="dred">+41C</b> dd = Кислотное дыхание</blockquote></div>
   // <b id="dred">+420</b> dd ?
   // <b id="dred">+44C</b> dd Кол-во активных заклинаний (для отображения при щелчке правой кнопкой)
   // <b id="dred">+454</b> dd <i class="event">441B17</i> (кол-во ответов на атаку; 0 = не отвечает на атаку)
   // настройка для грифонов <i class="event">46D6A0</i>
   // * инфо по некоторым эффектам заклинаний:
   // <b id="dred">+458</b> dd Благословение добавляет к макс.урону
   // <b id="dred">+45C</b> dd Проклятье убавляет к миним.урону
   // <b id="dred">+460</b> dd эффект Антимагии
   // <b id="dred">+464</b> dd Жажда крови добавляет к Атаке с бонусами
   // <b id="dred">+468</b> dd Точность добавляет к Атаке с бонусами
   // <b id="dred">+46C</b> dd эффект Слабости
   // <b id="dred">+470</b> dd бонус Каменной кожи
   // <b id="dred">+474</b> dd ?
   // <b id="dred">+478</b> dd бонус Молитвы
   // <b id="dred">+47C</b> dd эффект Радости
   // <b id="dred">+480</b> dd эффект Печали
   // <b id="dred">+484</b> dd бонус Удачи
   // <b id="dred">+488</b> dd эффект Неудачи
   // <b id="dred">+48C</b> dd флаги КОРОЛЬ1,2,3 (1 = КОРОЛЬ_1, 2 = КОРОЛЬ_2, 3 = КОРОЛЬ_3)
   // используется для расчёта закла Палач. Бонус 8 к Атаке: 0x<i class="event">4421D2</i>
   // <b id="dred">+490</b> dd кол-во пройденных клеток до удара (сбрасывается после первого удара)
   // <b id="dred">+494</b> dd кол-во доп. ответов на атаку, добавленных Контрударом
   // <b id="dred">+498</b> float = расчётный бонус Бешенства
   // <b id="dred">+49C</b> float = расчётный урон контратаки при снятии Слепоты
   // <b id="dred">+4A0</b> float = расчётный урон Огненного щита
   // <b id="dred">+4A4</b> float = эффект Яда
   // <b id="dred">+4A8</b> float = эффект защиты от Воздуха
   // <b id="dred">+4AC</b> float = эффект защиты от Огня
   // <b id="dred">+4B0</b> float = эффект защиты от Воды
   // <b id="dred">+4B4</b> float = эффект защиты от Земли
   // <b id="dred">+4B8</b> float = бонус Щита
   // <b id="dred">+4BC</b> float = бонус Воздушного Щита
   // <b id="dred">+4C0</b> db = Ослеплён - снизить защиту (сбросить после?) при оживании (уст. перед ударом)
   // <b id="dred">+4C1</b> db = Парализован - снизить защиту (сбросить после?) при оживании (уст. перед ударом)
   // <b id="dred">+4C4</b> dd = Забывчивость - уровень (&gt;2 = не может стрелять)
   // <b id="dred">+4C8</b> float = бонус Медлительности
   // <b id="dred">+4CC</b> dd = бонус Ускорения (вычитается из скорости при снятии)
   // <b id="dred">+4D0</b> dd = эффект Болезни (на защиту)
   // <b id="dred">+4D4</b> dd = эффект Болезни (на атаку)
   // <b id="dred">+4DC</b> dd = величина бонуса при выборе защиты
   // <b id="dred">+4E0</b> dd = заклинание, что будет колдовать монстр (Сказочный дракон)
   // <b id="dred">+4E4</b> dd = эффект Магического Зеркала
   // <b id="dred">+4E8</b> dd = Мораль
   // <b id="dred">+4EC</b> dd = Удача <i class="event">44152A</i>
   // <b id="dred">+4F1</b> db - <i class="event">43DF88</i>
   // <b id="dred">+4F4</b> ? какие дендроиды удерживают этот стэк корнями
   // <b id="dred">+504</b> ? список стэков, что удерживаются корнями этого дендроида

   // <b id="dred">+514</b> dd
   // <b id="dred">+518</b> dd &rarr; dd первый \ <span style="position:relative;top:7">adjusted stacks pointers</span>
   // <b id="dred">+51C</b> dd &rarr; dd послед./

   // <b id="dred">+524</b> dd
   // <b id="dred">+528</b> dd &rarr; dd первый \ <span style="position:relative;top:7">adjusted to which stacks pointers</span>
   // <b id="dred">+52C</b> dd &rarr; dd послед./
</pre>
&nbsp;<br>
</p></body></html>